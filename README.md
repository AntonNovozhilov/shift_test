## Тестовое задание для ШИФТ

### Задача:
Реализовать Rest-сервис на **FastAPI** для просмотра текущей зарплаты и даты следующего повышения. Сотрудник должен иметь доступ только к своим данным.

### Описание реализации:
Для выполнения задачи было принято решение о создании 2 моделей:
1. **Модель грейда** (содержит данные по зарплате).
2. **Модель пользователя** (связана с моделью грейда и имеет дату трудоустройства и следующее повышение).

#### Функционал:
1. Регистрироваться может любой пользователь.
2. Менять пользователя (установить грейд) может только суперпользователь.
3. Создавать грейды может только суперпользователь. 

### Техническая реализация:
Проект написан на **FastAPI** с использованием **SQLAlchemy**, **Alembic**.
Зависимости зафиксированы с помощью менеджера зависимостей **Poetry**.
Тесты написаны с помощью библиотеки **pytest**.
Реализован запуск с помощью **Docker**.

### Установка приложения:

Для установки вам нужно установить на локальной машине [Docker](https://www.docker.com/)
1. Скачайте репозиторий себе на локальную машину:
   ```
   git clone git@github.com:AntonNovozhilov/shift_test.git
   ```
2. Создайте файл .env в основной папке проекта:
    ```
    secret=УСТАНОВИТЕ СЕКРЕТНОЕ СЛОВО
    postgres_db=НАЗВАНИЕ БАЗЫ ДАННЫХ
    postgres_user=ЛОГИН ПОЛЬЗОВАТЕЛЯ POSTGRES
    postgres_password=ПАРОЛЬ ПОЛЬЗОВАТЕЛЯ POSTGRES
    db_host=db
    db_port=5432
    ```
3. Запустите контейнеры с помощью команды:
    ```
    docker compose up --build
    ```
4. Выполните миграции. Для этого нужно узнать id контейнера, в котором находится Alembic:
Введите команду:
```
docker ps
```
Вы увидите что-то вроде:
```
CONTAINER ID   IMAGE              COMMAND                  CREATED          STATUS         PORTS                    NAMES
5c588f7a2ef3   shift_test-shift   "poetry run uvicorn …"   3 minutes ago    Up 3 minutes   0.0.0.0:8000->8000/tcp   shift_test-shift-1
f23d534647bb   postgres:13.10     "docker-entrypoint.s…"   17 minutes ago   Up 3 minutes   0.0.0.0:5432->5432/tcp   shift_test-db-1
```
Вам нужен id на против shift_test-shift.

Копируйте его и используйте команду:
```
docker exec -it "здесь вводим id" poetry run alembic upgrade head
```

5. Откройте http://127.0.0.1:8000/docs и зарегистрируйте пользователя:
Вам нужно передать такой JSON (без грейда, пока их нет):
```{
  "email": "example@gmail.com",
  "password": "example_password"
}
```
6. Меняйте зарегистрированного пользователя на суперадмина. Для этого в консоли выполните
```
docker exec -it (здесь указываем id, который на против postgres:13.10, смотрите пункт 4) bash
```
В консоли вы увидите что-то такое:
root@f23d534647bb:/#
Введите:
```
psql -U логин пользователя -d shift_api
```
Возможно, вас попросят ввести пароль.

После этого вы увидите shift_api=#. Введите следующее:
```
UPDATE "user"
SET is_superuser = true
WHERE id = 1;
```
Теперь можно выходить из консоли — вы зарегистрировали суперадмина.

### Функционал:
От лица суперпользователя можно:
1. Создавать грейды (указывать название должности и зарплату).
2. Менять уже зарегистрированным пользователям грейд.
3. Каждый пользователь может получить информацию только по своей:
    - Зарплате.
    - Дате следующего повышения.
